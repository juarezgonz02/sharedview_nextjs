(()=>{var e={};e.id=370,e.ids=[370],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},98188:e=>{"use strict";e.exports=require("module")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},7782:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>u,routeModule:()=>f,tree:()=>d});var s=r(73137),a=r(54647),o=r(4183),l=r.n(o),n=r(71775),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);r.d(t,i);let c=s.AppPageRouteModule,d=["",{children:["[rooms]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,12016)),"D:\\Nueva carpeta\\sharedview_nextjs\\NextJS Proyect\\src\\app\\[rooms]\\page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,26543)),"D:\\Nueva carpeta\\sharedview_nextjs\\NextJS Proyect\\src\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,51918,23)),"next/dist/client/components/not-found-error"]}],u=["D:\\Nueva carpeta\\sharedview_nextjs\\NextJS Proyect\\src\\app\\[rooms]\\page.js"],m="/[rooms]/page",x={require:r,loadChunk:()=>Promise.resolve()},f=new c({definition:{kind:a.x.APP_PAGE,page:"/[rooms]/page",pathname:"/[rooms]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},23358:(e,t,r)=>{Promise.resolve().then(r.bind(r,30208))},30208:(e,t,r)=>{"use strict";let s,a;r.r(t),r.d(t,{default:()=>Page});var o=r(60080),l=r(9885),n=r.n(l);let ChatComponent_message=({isMe:e,time:t,messageText:r,messageTitle:s})=>(0,o.jsxs)("div",{className:"flex flex-col gap-1",children:[e&&o.jsx("span",{className:"font-bold text-sm",children:`${t} - Yo: `}),!e&&o.jsx("span",{className:"font-bold text-sm",children:`${t} ${s}: `}),o.jsx("p",{className:"text-sm",children:r})]});var i=r(83423),c=r(24551);let d=(0,l.createContext)(),components_socketContext=({room:e,children:t})=>{let r=localStorage.getItem("username")||`USER ${(999*Math.random()).toFixed(0)}`,n=(0,l.useRef)(),[u,m]=(0,l.useState)(null),x=(0,l.useRef)(),f=(0,l.useRef)(new Map),[p,g]=(0,l.useState)([]),[h,j]=(0,l.useState)(!1),v=(0,l.useState)([]),[w,b]=v,y=(0,l.useRef)([]),newPeerHandler=e=>{console.log("know",e.userId);let t=n.current.call(e.userId,x.current,{metadata:{username:r,socketId:s.id}});t.on("stream",function(t){f.current.set(e.userId,{id:e.userId,socketId:e.socketId,username:e.username,media:t,isMe:!1}),g([...p,e.userId])}),s.emit("received",{toSocketId:e.socketId,myUserId:a})},incomingMessageHandler=e=>{console.log("NEW MESSAGE",e),y.current=[...y.current,e],b(y.current)},deleteUserBySocketId=e=>{f.current.forEach((t,r)=>{t.socketId===e&&(console.log("Deleting...",r),f.current.delete(r),g(f.current))})},handleUserDisconnected=e=>{console.log("USER DISCONECTED",e),deleteUserBySocketId(e)},socketConnectionHandler=()=>{console.log("Server Connected "),j(!0),s.on("new-peer",newPeerHandler),s.on("incoming-message",incomingMessageHandler),s.on("error",()=>{console.log("Server Not found ")}),s.on("user-disconnected",handleUserDisconnected)},gotStream=e=>{e.getAudioTracks()[0].enabled=!1,console.log("Adding local stream."),x.current=e,m(e)},getUserMedia=()=>{(async()=>{let e=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0});gotStream(e)})()},getUserId=()=>{n.current=new c.Peer},incomingCallHandler=e=>{e.answer(x.current),e.on("stream",t=>{f.current.set(e.peer,{id:e.peer,username:e.metadata.username,socketId:e.metadata.socketId,media:t,isMe:!1}),g([...p,e.peer])}),e.on("close",()=>{f.current.delete(e.peer),g([...p,e.peer])})},sendPeerOfferToOthers=t=>{console.log("Send offer to room"),s.emit("offerToRoom",{userId:t,username:r,socketId:s.id,room:e})},setAnswerListener=()=>{n.current.on("open",e=>{a=e,f.current.set(a,{id:a,username:r,media:x.current,isMe:!0}),g([...p,a]),console.log("My peer ID is: "+a),n.current.on("call",incomingCallHandler),sendPeerOfferToOthers(e)})};(0,l.useEffect)(()=>{let e="https://media.sharedview.live:443";s=(0,i.ZP)(e,{path:"/io/socket.io"}),console.log("Try connection",e),s.on("connect",socketConnectionHandler)},[]),(0,l.useEffect)(()=>{console.log("ChannelStatus",h),h&&getUserMedia()},[h]),(0,l.useEffect)(()=>{null!==u&&(getUserId(),setAnswerListener())},[u]),(0,l.useEffect)(()=>{console.log(f.current)},[f.current]);let C={socketConnection:s,media:x,rtcPeer:n,channelReady:h,sendChatMessage:t=>{y.current=[...w,{room:e,msg:t,from:r,isMe:!0}],b(y.current),s.emit("newMessage",{room:e,msg:t,fromSocket:s.id,from:r,isMe:!1})},users:f,messagesState:v};return(0,o.jsxs)(d.Provider,{value:C,children:[" ",t," "]})};var u=r(77829),m=r(72781),x=r(34791),f=r(75737);let chat=({toggleChat:e})=>{let t=n().useRef(null),r=(0,l.useContext)(d).sendChatMessage,[s,a]=(0,l.useContext)(d).messagesState;return(0,o.jsxs)("div",{className:"flex flex-col justify-between w-full px-4 rounded-md h-screen-90 py-8 bg-dark tablet:w-10/12",children:[(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[o.jsx(f.default,{className:"hidden tablet:flex tablet:cursor-pointer tablet:ml-auto",onClick:e}),o.jsx("span",{children:"Mensajes de la llamada"}),o.jsx("span",{className:"text-center text-xs opacity-50",children:"Los mensajes se borran al finalizar la llamada"})]}),o.jsx("div",{id:"messages-container",className:"flex flex-col w-full h-4/5 overflow-y-auto gap-2 p-4",children:s.map(e=>{let t=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"});return o.jsx(ChatComponent_message,{isMe:e.isMe,time:t,messageText:e.msg,messageTitle:e.from},t+e.from)})}),o.jsx(x.default,{theme:{components:{Input:{colorBgContainer:"#181818",colorBorder:"#1e1e1e",colorBorder:"rgba(255, 255, 255, 0.4)",colorText:"#fff",colorTextPlaceholder:"rgba(255, 255, 255, 0.4)",activeBorderColor:"#fff",hoverBorderColor:"#fff",colorError:"#fff"}}},children:o.jsx(u.Z,{name:"normal_login",onFinish:e=>{a([{from:"Me",msg:e.identifier,isMe:!0},...s]),r(e.identifier),t.current.resetFields()},layout:"vertical",ref:t,children:o.jsx(u.Z.Item,{name:"identifier",children:o.jsx(m.Z,{size:"middle",placeholder:"Escribe un mensaje",autoComplete:"off",autoFocus:!0})})})})]})};var p=r(5446),g=r.n(p),h=r(57114),j=r(79636),v=r.n(j),w=r(18180),b=r(72479),y=r(52451),C=r.n(y);let A={src:"/_next/static/media/Questions-bro.340faddd.png",height:2e3,width:2e3,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAbFBMVEVMaXHfw++9i9m0eNPIotzRteDGnOXUsePau+z////bw+bRut3hxPDq4PTaueusmrjJm+KRjp6RkaXZuOmDcpCOdaCbcrWPWa6mfL8xHE5+ZpZWNHTizuzlwffszvy9qM7dtPKmmK+8mM6KRrAmSNZ6AAAAH3RSTlMAef3+8rcYN08Bj/MjGYX72E8z9P38/uT+YX/////+x1yuNAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAEZJREFUeJwVy0UWgCAAQMFPCYLdhRj3v6PP2Q85eddmAIWpb22hbK5hPAyIKPf9CRnVqad3SQ7bH0qF5MH6WZ7R/W/dhOMDdhMDWdytPEwAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8};var S=r(17802),N=r(81057),_=r(637),P=r(77238);let StreamPlayer_NavbarCall=({toggleChat:e})=>{let t=(0,h.useRouter)();return(0,o.jsxs)("div",{className:"w-full flex flex-row items-center gap-4 tablet:justify-between",children:[(0,o.jsxs)("div",{className:"flex flex-row items-center gap-4",children:[o.jsx(_.Z,{style:{fontSize:"20px",color:"#fff",cursor:"pointer"},onClick:()=>{t.back()}}),o.jsx("span",{className:"text-white text-sm font-bold",children:"Volver"})]}),(0,o.jsxs)("div",{className:"hidden tablet:flex tablet:flex-row tablet:items-center tablet:gap-1",onClick:e,children:[o.jsx(P.Z,{}),o.jsx("span",{className:"text-white text-sm font-bold",children:"Chat"})]})]})},StreamPlayer_StreamInstruction=({isLoaded:e})=>{let t="rtmp://media.sharedview.live:1935/live/",r=`${document.location.pathname.substring(1)}?sign=${b.Z.get("room-exp")}-${b.Z.get("sign")}&expiration=${b.Z.get("room-exp")}`,copy=async e=>{try{await navigator.clipboard.writeText(e),console.log("Page URL copied to clipboard")}catch(e){console.error("Failed to copy: ",e)}},[s,a]=(0,l.useState)("overflow-hidden flex visible justify-center flex-col items-center gap-2");return(0,l.useEffect)(()=>{e&&a("hidden")},[e]),o.jsx("div",{className:s,children:(0,o.jsxs)(x.default,{theme:{components:{Button:{colorBgTextHover:"#fff",colorPrimaryHover:"#fff",colorTextDisabled:"rgba(255, 255, 255, 0.5)",colorBgContainerDisabled:"rgba(127, 25, 180, 0.5))",colorPrimaryActive:"#fff"},Tag:{defaultBg:"#1e1e1e",defaultColor:"#fff",marginXS:"0.2rem"}}},children:[o.jsx(C(),{width:150,height:150,src:A,alt:"sharedview img"}),(0,o.jsxs)("div",{className:"flex flex-row gap-2",children:[o.jsx("h2",{className:"text-lg font-bold text-white",children:"Como transmitir en vivo"}),o.jsx(N.default,{placement:"top",title:"Puedes usar OBS, XSplit, Streamlabs OBS, o cualquier otro software de streaming",children:o.jsx(S.default,{style:{color:"white",fontSize:"1.2rem"}})})]}),o.jsx("p",{className:"text-white text-center text-sm",children:"1. En el software de streaming, selecciona la opci\xf3n de RTMP como tipo de servidor y coloca la siguiente URL como servidor:"}),o.jsx("p",{className:"text-white text-center text-sm",children:"2. En el lugar de la URL:"}),(0,o.jsxs)("p",{className:"w-fit flex flex-row gap-2",children:[o.jsx(w.Z,{children:`${t}  `}),o.jsx("button",{className:"text-white text-sm font-bold",onClick:()=>copy(t),children:"Copiar"})]}),o.jsx("p",{className:"w-fit text-sm text-center",children:"3. En el steam usa la siguiente llave de transmisi\xf3n:"}),(0,o.jsxs)("p",{className:"w-fit flex flex-row gap-2",children:[o.jsx(w.Z,{children:`${r.length>10?r.substring(0,30)+"...":r}`}),o.jsx("button",{className:"text-white text-sm font-bold",onClick:()=>copy(r),children:"Copiar"})]}),o.jsx("p",{className:"w-fit text-sm text-center",children:"4. \xa1Listo!, recarga la p\xe1gina para ver tu transmisi\xf3n en vivo."}),(0,o.jsxs)("p",{children:[o.jsx("br",{}),o.jsx(v(),{onClick:()=>window.location.reload(),className:"bg-purple hover:bg-violet-900 text-white border-none phone:w-full",children:"Recargar"})]})]})})},streamplayer=({toggleChat:e})=>{let[t,r]=(0,l.useState)(!1),s=(0,l.useRef)(),{rooms:a}=(0,h.useParams)(),n=`https://media.sharedview.live:443/live/${a}.flv?sign=${b.Z.get("room-exp")}-${b.Z.get("sign")}`,play_stream=async()=>{try{if(g().isSupported()){g().LoggingControl.enableError=!1,g().LoggingControl.enableAll=!1;let e=g().createPlayer({type:"flv",url:n,isLive:!0});e.on(g().Events.METADATA_ARRIVED,()=>{r(!0),s.current.className="static loaded-stream-video"}),e.attachMediaElement(s.current),e.load(),e.play()}}catch(e){console.log("Stream Server Connection Failed")}};return(0,l.useEffect)(()=>{try{play_stream()}catch(e){console.log("Stream Server Connection Failed")}},[]),(0,o.jsxs)("div",{className:"flex flex-col items-start gap-4 justify-start w-full",children:[o.jsx(StreamPlayer_NavbarCall,{toggleChat:e}),o.jsx(StreamPlayer_StreamInstruction,{isLoaded:t}),o.jsx("div",{hidden:!t,className:"w-11/12 rounded-md",children:o.jsx("video",{autoPlay:!0,controls:!0,className:"stream-video",ref:s})})]})};var M=r(1808);let p5=({username:e,media:t})=>o.jsx(M.g,{sketch:function(r){let s,a,o,l,n;window.p5=r,r.preload=()=>{},r.setup=()=>{r.createCanvas(40,40),new window.AudioContext,s=40,a=40,r.frameRate(30);let e=new window.AudioContext;(n=e.createAnalyser()).fftSize=256;let i=e.createMediaStreamSource(t);i.connect(n),o=n.frequencyBinCount,l=new Uint8Array(o)},r.draw=()=>{r.background("#121212"),r.fill(50),r.stroke(50);let t=function(){n.getByteFrequencyData(l);let e=0;for(let t=0;t<o;t++)e+=l[t];let t=e/o;return t}(),i=r.map(t,0,255,0,40);r.ellipse(s/2,a/2,i,i),r.strokeWeight(1),r.stroke(255),r.fill("#121212"),r.ellipse(s/2,a/2,40,40),r.textSize(40),r.strokeWeight(.01);let c=e[0].toUpperCase();r.fill(255,255,255),r.text(c,s/2-r.textWidth(c)/2,a/2+16)}}}),CallInterface_RemoteStream=({stream:e})=>{let t=(0,l.useRef)();return(0,l.useEffect)(()=>{console.log(e),t.current.srcObject=e,t.current.play()},[]),o.jsx("div",{className:"user",children:o.jsx("audio",{className:"remoteAudio",ref:t,children:" "})})};var k=r(95333),I=r(87087);let CallInterface_VoiceController=({username:e})=>{let[t,r]=(0,l.useState)(!1),{media:s,channelReady:a}=(0,l.useContext)(d),switchMute=()=>{a&&(t?(s.current.getAudioTracks()[0].enabled=!1,r(!1)):(s.current.getAudioTracks()[0].enabled=!0,r(!0)))};return(0,o.jsxs)("div",{className:"flex flex-col items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex flex-row items-center",children:[null==t&&o.jsx("div",{onClick:switchMute,className:"controler_waiting border border-warning",id:"controler"}),t&&o.jsx(k.Z,{onClick:switchMute,id:"controler",twoToneColor:"#52c41a",style:{fontSize:"40px",color:"#52c41a"}}),!t&&o.jsx(I.Z,{onClick:switchMute,id:"controler",style:{fontSize:"40px",color:"#ff0000"}})]}),o.jsx("p",{className:"text-white text-sm",children:e})]})},callInterface=()=>{let e=(0,l.useContext)(d).users;return o.jsx("div",{className:"flex flex-col w-auto items-center gap-2 justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"flex",children:Array.from(e.current.values()).map(e=>!e.isMe&&(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[o.jsx(CallInterface_RemoteStream,{stream:e.media,id:e.id},`audio_of_${e.id}`),o.jsx(p5,{media:e.media,username:e.username},`sketch_of_${e.id}`),(0,o.jsxs)("span",{className:"text-sm",children:[" ",e.username," "]})]},`container_of_${e.id}`))})})})};function Page({params:e}){let[t,r]=(0,l.useState)(!1),toggleChat=()=>{r(!t)};return o.jsx(components_socketContext,{room:e.rooms,children:(0,o.jsxs)("div",{className:"flex flex-row items-center justify-center min-h-screen mx-8 tablet:flex-col",children:[(0,o.jsxs)("div",{className:"w-3/4 h-max flex flex-col items-start justify-center gap-8 tablet:w-full tablet:h-full",children:[o.jsx(streamplayer,{toggleChat:toggleChat}),(0,o.jsxs)("div",{className:"flex flex-row items-center justify-center gap-6",children:[o.jsx(CallInterface_VoiceController,{username:"Me"},"voice-controller-component"),o.jsx(callInterface,{})]})]}),o.jsx("div",{id:"chat",className:"w-1/4 h-max flex items-center justify-center tablet:hidden",style:t?{display:"flex",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"100",backgroundColor:"rgba(0,0,0,0.8)"}:{},children:o.jsx(chat,{toggleChat:toggleChat})})]})})}r(4033)},12016:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>l,__esModule:()=>o,default:()=>i});var s=r(17536);let a=(0,s.createProxy)(String.raw`D:\Nueva carpeta\sharedview_nextjs\NextJS Proyect\src\app\[rooms]\page.js`),{__esModule:o,$$typeof:l}=a,n=a.default,i=n},4033:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[659,636,975,412,117,59],()=>__webpack_exec__(7782));module.exports=r})();