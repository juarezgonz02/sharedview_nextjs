(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[370],{65602:function(e,t,r){Promise.resolve().then(r.bind(r,23503))},23503:function(e,t,r){"use strict";let s,a;r.r(t),r.d(t,{default:function(){return Page}});var n=r(57437),o=r(2265),ChatComponent_message=e=>{let{isMe:t,time:r,messageText:s,messageTitle:a}=e;return(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[t&&(0,n.jsx)("span",{className:"font-bold text-sm",children:"".concat(r," - Yo: ")}),!t&&(0,n.jsx)("span",{className:"font-bold text-sm",children:"".concat(r," ").concat(a,": ")}),(0,n.jsx)("p",{className:"text-sm",children:s})]})},l=r(63388),c=r(93490);let i=(0,o.createContext)();var components_socketContext=e=>{let{room:t,children:r}=e,d=localStorage.getItem("username")||"USER ".concat((999*Math.random()).toFixed(0)),m=(0,o.useRef)(),[f,u]=(0,o.useState)(null),x=(0,o.useRef)(),g=(0,o.useRef)(new Map),[h,p]=(0,o.useState)([]),[j,w]=(0,o.useState)(!1),v=(0,o.useState)([]),[C,A]=v,b=(0,o.useRef)([]),newPeerHandler=e=>{console.log("know",e.userId);let t=m.current.call(e.userId,x.current,{metadata:{username:d,socketId:s.id}});t.on("stream",function(t){g.current.set(e.userId,{id:e.userId,socketId:e.socketId,username:e.username,media:t,isMe:!1}),p([...h,e.userId])}),s.emit("received",{toSocketId:e.socketId,myUserId:a})},incomingMessageHandler=e=>{console.log("NEW MESSAGE",e),b.current=[...b.current,e],A(b.current)},deleteUserBySocketId=e=>{g.current.forEach((t,r)=>{t.socketId===e&&(console.log("Deleting...",r),g.current.delete(r),p(g.current))})},handleUserDisconnected=e=>{console.log("USER DISCONECTED",e),deleteUserBySocketId(e)},socketConnectionHandler=()=>{console.log("Server Connected "),w(!0),s.on("new-peer",newPeerHandler),s.on("incoming-message",incomingMessageHandler),s.on("error",()=>{console.log("Server Not found ")}),s.on("user-disconnected",handleUserDisconnected)},gotStream=e=>{e.getAudioTracks()[0].enabled=!1,console.log("Adding local stream."),x.current=e,u(e)},getUserMedia=()=>{(async()=>{let e=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0});gotStream(e)})()},getUserId=()=>{m.current=new c._z},incomingCallHandler=e=>{e.answer(x.current),e.on("stream",t=>{g.current.set(e.peer,{id:e.peer,username:e.metadata.username,socketId:e.metadata.socketId,media:t,isMe:!1}),p([...h,e.peer])}),e.on("close",()=>{g.current.delete(e.peer),p([...h,e.peer])})},sendPeerOfferToOthers=e=>{console.log("Send offer to room"),s.emit("offerToRoom",{userId:e,username:d,socketId:s.id,room:t})},setAnswerListener=()=>{m.current.on("open",e=>{a=e,g.current.set(a,{id:a,username:d,media:x.current,isMe:!0}),p([...h,a]),console.log("My peer ID is: "+a),m.current.on("call",incomingCallHandler),sendPeerOfferToOthers(e)})};(0,o.useEffect)(()=>{let e="".concat("https","://").concat("media.sharedview.live",":").concat("443");s=(0,l.ZP)(e,{path:"/io/socket.io"}),console.log("Try connection",e),s.on("connect",socketConnectionHandler)},[]),(0,o.useEffect)(()=>{console.log("ChannelStatus",j),j&&getUserMedia()},[j]),(0,o.useEffect)(()=>{null!==f&&(getUserId(),setAnswerListener())},[f]),(0,o.useEffect)(()=>{console.log(g.current)},[g.current]);let y={socketConnection:s,media:x,rtcPeer:m,channelReady:j,sendChatMessage:e=>{b.current=[...C,{room:t,msg:e,from:d,isMe:!0}],A(b.current),s.emit("newMessage",{room:t,msg:e,fromSocket:s.id,from:d,isMe:!1})},users:g,messagesState:v};return(0,n.jsxs)(i.Provider,{value:y,children:[" ",r," "]})},d=r(79404),m=r(43574),f=r(9273),u=r(60077),chat=e=>{let{toggleChat:t}=e,r=o.useRef(null),s=(0,o.useContext)(i).sendChatMessage,[a,l]=(0,o.useContext)(i).messagesState;return(0,n.jsxs)("div",{className:"flex flex-col justify-between w-full px-4 rounded-md h-screen-90 py-8 bg-dark tablet:w-10/12",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[(0,n.jsx)(u.default,{className:"hidden tablet:flex tablet:cursor-pointer tablet:ml-auto",onClick:t}),(0,n.jsx)("span",{children:"Mensajes de la llamada"}),(0,n.jsx)("span",{className:"text-center text-xs opacity-50",children:"Los mensajes se borran al finalizar la llamada"})]}),(0,n.jsx)("div",{id:"messages-container",className:"flex flex-col w-full h-4/5 overflow-y-auto gap-2 p-4",children:a.map(e=>{let t=new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"});return(0,n.jsx)(ChatComponent_message,{isMe:e.isMe,time:t,messageText:e.msg,messageTitle:e.from},t+e.from)})}),(0,n.jsx)(f.default,{theme:{components:{Input:{colorBgContainer:"#181818",colorBorder:"#1e1e1e",colorBorder:"rgba(255, 255, 255, 0.4)",colorText:"#fff",colorTextPlaceholder:"rgba(255, 255, 255, 0.4)",activeBorderColor:"#fff",hoverBorderColor:"#fff",colorError:"#fff"}}},children:(0,n.jsx)(d.Z,{name:"normal_login",onFinish:e=>{l([{from:"Me",msg:e.identifier,isMe:!0},...a]),s(e.identifier),r.current.resetFields()},layout:"vertical",ref:r,children:(0,n.jsx)(d.Z.Item,{name:"identifier",children:(0,n.jsx)(m.Z,{size:"middle",placeholder:"Escribe un mensaje",autoComplete:"off",autoFocus:!0})})})})]})},x=r(41517),g=r.n(x),h=r(24033),p=r(88110),j=r.n(p),w=r(88500),v=r(11490),C=r(16691),A=r.n(C),b={src:"/_next/static/media/Questions-bro.340faddd.png",height:2e3,width:2e3,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABE0lEQVR4nAEIAff+Ady+6wMMCA39y+HCAAYCCjXz9u8bDOgjyDhNIuj0/O8CAeLD8QAABP4Z8u31n+b04kf4+/UAHg0m8AcFCT/0+fPSAfjf/hPRxuDMCg4HIL/Ouf8OBxP8MzItBfz5/8ApGCJBAdm66YP8+/x87+r3+aCfqwcAAf7/WGNIARUWEO738f0mAdW25ZUEBQRq8O30+OXo5gfo1/YBHiwR/xIZCgEaEx5LAdu77DL6/PrM/QT3AeHV7wAJAgv+FyUK+/Dw8QcaFhydAdO34gD++/8y+QXyZ8+940gpKiIeGR8SAP79/wD///9WAcat1AMMDAv94eHlAE1mhWaXfGIiSURE/Pb3984DAwOuQIGGZSD9BYUAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},y=r(97741),S=r(82044),N=r(66111),I=r(71736),StreamPlayer_NavbarCall=e=>{let{toggleChat:t}=e,r=(0,h.useRouter)();return(0,n.jsxs)("div",{className:"w-full flex flex-row items-center gap-4 tablet:justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-4",children:[(0,n.jsx)(N.Z,{style:{fontSize:"20px",color:"#fff",cursor:"pointer"},onClick:()=>{r.back()}}),(0,n.jsx)("span",{className:"text-white text-sm font-bold",children:"Volver"})]}),(0,n.jsxs)("div",{className:"hidden tablet:flex tablet:flex-row tablet:items-center tablet:gap-1",onClick:t,children:[(0,n.jsx)(I.Z,{}),(0,n.jsx)("span",{className:"text-white text-sm font-bold",children:"Chat"})]})]})},StreamPlayer_StreamInstruction=e=>{let{isLoaded:t}=e,r="rtmp://media.sharedview.live:1935/live/",s="".concat(document.location.pathname.substring(1),"?sign=").concat(v.Z.get("room-exp"),"-").concat(v.Z.get("sign"),"&expiration=").concat(v.Z.get("room-exp")),copy=async e=>{try{await navigator.clipboard.writeText(e),console.log("Page URL copied to clipboard")}catch(e){console.error("Failed to copy: ",e)}},[a,l]=(0,o.useState)("overflow-hidden flex visible justify-center flex-col items-center gap-2");return(0,o.useEffect)(()=>{t&&l("hidden")},[t]),(0,n.jsx)("div",{className:a,children:(0,n.jsxs)(f.default,{theme:{components:{Button:{colorBgTextHover:"#fff",colorPrimaryHover:"#fff",colorTextDisabled:"rgba(255, 255, 255, 0.5)",colorBgContainerDisabled:"rgba(127, 25, 180, 0.5))",colorPrimaryActive:"#fff"},Tag:{defaultBg:"#1e1e1e",defaultColor:"#fff",marginXS:"0.2rem"}}},children:[(0,n.jsx)(A(),{width:150,height:150,src:b,alt:"sharedview img"}),(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-white",children:"Como transmitir en vivo"}),(0,n.jsx)(S.default,{placement:"top",title:"Puedes usar OBS, XSplit, Streamlabs OBS, o cualquier otro software de streaming",children:(0,n.jsx)(y.default,{style:{color:"white",fontSize:"1.2rem"}})})]}),(0,n.jsx)("p",{className:"text-white text-center text-sm",children:"1. En el software de streaming, selecciona la opci\xf3n de RTMP como tipo de servidor y coloca la siguiente URL como servidor:"}),(0,n.jsx)("p",{className:"text-white text-center text-sm",children:"2. En el lugar de la URL:"}),(0,n.jsxs)("p",{className:"w-fit flex flex-row gap-2",children:[(0,n.jsx)(w.Z,{children:"".concat(r,"  ")}),(0,n.jsx)("button",{className:"text-white text-sm font-bold",onClick:()=>copy(r),children:"Copiar"})]}),(0,n.jsx)("p",{className:"w-fit text-sm text-center",children:"3. En el steam usa la siguiente llave de transmisi\xf3n:"}),(0,n.jsxs)("p",{className:"w-fit flex flex-row gap-2",children:[(0,n.jsx)(w.Z,{children:"".concat(s.length>10?s.substring(0,30)+"...":s)}),(0,n.jsx)("button",{className:"text-white text-sm font-bold",onClick:()=>copy(s),children:"Copiar"})]}),(0,n.jsx)("p",{className:"w-fit text-sm text-center",children:"4. \xa1Listo!, recarga la p\xe1gina para ver tu transmisi\xf3n en vivo."}),(0,n.jsxs)("p",{children:[(0,n.jsx)("br",{}),(0,n.jsx)(j(),{onClick:()=>window.location.reload(),className:"bg-purple hover:bg-violet-900 text-white border-none phone:w-full",children:"Recargar"})]})]})})},streamplayer=e=>{let{toggleChat:t}=e,[r,s]=(0,o.useState)(!1),a=(0,o.useRef)(),{rooms:l}=(0,h.useParams)(),c="".concat("https","://").concat("media.sharedview.live",":").concat("443","/live/").concat(l,".flv")+"?sign=".concat(v.Z.get("room-exp"),"-").concat(v.Z.get("sign")),play_stream=async()=>{try{if(g().isSupported()){g().LoggingControl.enableError=!1,g().LoggingControl.enableAll=!1;let e=g().createPlayer({type:"flv",url:c,isLive:!0});e.on(g().Events.METADATA_ARRIVED,()=>{s(!0),a.current.className="static loaded-stream-video"}),e.attachMediaElement(a.current),e.load(),e.play()}}catch(e){console.log("Stream Server Connection Failed")}};return(0,o.useEffect)(()=>{try{play_stream()}catch(e){console.log("Stream Server Connection Failed")}},[]),(0,n.jsxs)("div",{className:"flex flex-col items-start gap-4 justify-start w-full",children:[(0,n.jsx)(StreamPlayer_NavbarCall,{toggleChat:t}),(0,n.jsx)(StreamPlayer_StreamInstruction,{isLoaded:r}),(0,n.jsx)("div",{hidden:!r,className:"w-11/12 rounded-md",children:(0,n.jsx)("video",{autoPlay:!0,controls:!0,className:"stream-video",ref:a})})]})},k=r(48065),p5=e=>{let{username:t,media:r}=e;return(0,n.jsx)(k.g,{sketch:function(e){let s,a,n,o,l;window.p5=e,e.preload=()=>{},e.setup=()=>{e.createCanvas(40,40),new window.AudioContext,s=40,a=40,e.frameRate(30);let t=new window.AudioContext;(l=t.createAnalyser()).fftSize=256;let c=t.createMediaStreamSource(r);c.connect(l),n=l.frequencyBinCount,o=new Uint8Array(n)},e.draw=()=>{e.background("#121212"),e.fill(50),e.stroke(50);let r=function(){l.getByteFrequencyData(o);let e=0;for(let t=0;t<n;t++)e+=o[t];let t=e/n;return t}(),c=e.map(r,0,255,0,40);e.ellipse(s/2,a/2,c,c),e.strokeWeight(1),e.stroke(255),e.fill("#121212"),e.ellipse(s/2,a/2,40,40),e.textSize(40),e.strokeWeight(.01);let i=t[0].toUpperCase();e.fill(255,255,255),e.text(i,s/2-e.textWidth(i)/2,a/2+16)}}})},CallInterface_RemoteStream=e=>{let{stream:t}=e,r=(0,o.useRef)();return(0,o.useEffect)(()=>{console.log(t),r.current.srcObject=t,r.current.play()},[]),(0,n.jsx)("div",{className:"user",children:(0,n.jsx)("audio",{className:"remoteAudio",ref:r,children:" "})})},E=r(87502),M=r(84615),CallInterface_VoiceController=e=>{let{username:t}=e,[r,s]=(0,o.useState)(!1),{media:a,channelReady:l}=(0,o.useContext)(i),switchMute=()=>{l&&(r?(a.current.getAudioTracks()[0].enabled=!1,s(!1)):(a.current.getAudioTracks()[0].enabled=!0,s(!0)))};return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-row items-center",children:[null==r&&(0,n.jsx)("div",{onClick:switchMute,className:"controler_waiting border border-warning",id:"controler"}),r&&(0,n.jsx)(E.Z,{onClick:switchMute,id:"controler",twoToneColor:"#52c41a",style:{fontSize:"40px",color:"#52c41a"}}),!r&&(0,n.jsx)(M.Z,{onClick:switchMute,id:"controler",style:{fontSize:"40px",color:"#ff0000"}})]}),(0,n.jsx)("p",{className:"text-white text-sm",children:t})]})},callInterface=()=>{let e=(0,o.useContext)(i).users;return(0,n.jsx)("div",{className:"flex flex-col w-auto items-center gap-2 justify-center",children:(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"flex",children:Array.from(e.current.values()).map(e=>!e.isMe&&(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,n.jsx)(CallInterface_RemoteStream,{stream:e.media,id:e.id},"audio_of_".concat(e.id)),(0,n.jsx)(p5,{media:e.media,username:e.username},"sketch_of_".concat(e.id)),(0,n.jsxs)("span",{className:"text-sm",children:[" ",e.username," "]})]},"container_of_".concat(e.id)))})})})};function Page(e){let{params:t}=e,[r,s]=(0,o.useState)(!1),toggleChat=()=>{s(!r)};return(0,n.jsx)(components_socketContext,{room:t.rooms,children:(0,n.jsxs)("div",{className:"flex flex-row items-center justify-center min-h-screen mx-8 tablet:flex-col",children:[(0,n.jsxs)("div",{className:"w-3/4 h-max flex flex-col items-start justify-center gap-8 tablet:w-full tablet:h-full",children:[(0,n.jsx)(streamplayer,{toggleChat:toggleChat}),(0,n.jsxs)("div",{className:"flex flex-row items-center justify-center gap-6",children:[(0,n.jsx)(CallInterface_VoiceController,{username:"Me"},"voice-controller-component"),(0,n.jsx)(callInterface,{})]})]}),(0,n.jsx)("div",{id:"chat",className:"w-1/4 h-max flex items-center justify-center tablet:hidden",style:r?{display:"flex",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"100",backgroundColor:"rgba(0,0,0,0.8)"}:{},children:(0,n.jsx)(chat,{toggleChat:toggleChat})})]})})}r(22523)},22523:function(){}},function(e){e.O(0,[97,964,718,110,6,69,971,864,744],function(){return e(e.s=65602)}),_N_E=e.O()}]);